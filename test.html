<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instagram DoomScroll Simulator</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    /* Instagram styling */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { 
      height: 100%; 
      overflow: hidden; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
      background: #fafafa;
    }
    h1 {
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      z-index: 1000; color: #262626; font-weight: 600; font-size: 24px;
    }
    #feed-container {
      height: 100vh; width: 100vw; overflow-y: scroll;
      scroll-snap-type: y mandatory; scroll-behavior: smooth;
      background: #fafafa;
    }
    .video-post {
      height: 100vh; width: 100vw; position: relative;
      scroll-snap-align: start; scroll-snap-stop: always;
    }
    .player-container {
      width: 390px; height: 640px; position: absolute;
      top: 50%; left: 50%; transform: translate(-50%, -50%);
      border-radius: 12px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    .video-overlay {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      color: white; padding: 40px 30px 30px;
    }
    .video-info .author { font-weight: 600; font-size: 16px; margin-bottom: 4px; }
    .video-info .title { font-size: 14px; line-height: 1.4; opacity: 0.9; }
    .video-actions {
      position: absolute; bottom: 30px; right: 30px;
      display: flex; flex-direction: column; gap: 20px;
    }
    .video-actions .action-icon {
      font-size: 28px !important; color: white !important; cursor: pointer !important;
      text-shadow: 0 1px 4px rgba(0,0,0,0.5) !important; transition: all 0.2s !important;
      width: 40px; height: 40px; display: flex !important; align-items: center; justify-content: center;
    }
    .video-actions .action-icon:hover { color: #fff !important; transform: scale(1.1); }
    .video-actions .action-icon.liked { color: #ed4956 !important; }
    .video-post.item-hide { opacity: 0; transform: scale(0.8); }
    .video-post.item-focus, .video-post.item-next { opacity: 1; transform: scale(1); }
    #feed-container iframe { border: none !important; }
    #feed-container .ytp-chrome-top, .ytp-gradient-top, .ytp-pause-overlay { display: none !important; }
    @media (max-width: 768px) {
      .player-container { width: 100%; height: 100vh; position: static; transform: none; border-radius: 0; }
    }
    #feed-container::-webkit-scrollbar { width: 4px; }
    #feed-container::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 2px; }
    /* Dark modal */
    .comment-modal .modal-background { background-color: rgba(10,10,10,0.85) !important; }
    .comment-modal .box { background-color: #262626 !important; border: 1px solid #404040 !important; }
    .comment-modal .input { background-color: #1e1e1e !important; border: 1px solid #404040 !important; color: white !important; }
    .comment-modal .input::placeholder { color: #8e8e8e !important; }
  </style>
</head>
<body>
  <div id="feed-container"></div>
  <div id="modal-container"></div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // YOUR VIDEO DATA - UNTOUCHED
    
    const videoData = [
      // funny, humor
{
        id: 1, //
        videoId: 'B2UOucuMlyg',
        title: 'Luggage weight back âœˆï¸ #travel #luggage  #travelhacks #airport #traveling',
        author: 'Zore & Tomek',
        hashtags: ['funny', 'humor']
      },
{
        id: 2, //
        videoId: 'rTbUnyR6ASg',
        title: 'When a stranger\'s kid becomes your travel buddy âœˆï¸ðŸ¥°ðŸ¤£ #fyp #travel #foryou #toddler #thankful',
        author: 'quickreel18',
        hashtags: ['funny', 'humor']
      },
{
        id: 3, //
        videoId: '8ZexdCzO0o4',
        title: 'Budget Friendly International Trips | Cheapest Country to Travel from India | Khushboo Vasudeva',
        author: 'Khushboo Vasudeva',
        hashtags: ['funny', 'humor']
      },
{
        id: 4, //
        videoId: 'oVMJS3E0AM8',
        title: 'TRAVEL WITH ME TO MOROCCO TO SEE MY BFF\'s ðŸ˜­âœˆï¸ #fypã‚·ã‚š #travel #morocco #vlog #summer #viral',
        author: 'JUSTJULESðŸ’–',
        hashtags: ['funny', 'humor']
      },

{
        id: 8,//
        videoId: 'Ym7jswVl4Fs',
        title: 'The Most Beautiful Places In The USA ðŸ¤©ðŸ‡ºðŸ‡¸ #travel #nature #usa #explore #relaxing',
        author: 'The Places You Seek',
        hashtags: ['funny', 'humor']
      },
      {
        id: 5,
        videoId: 'MQ-Fq1fsd-k',
        title: 'must have for travel ðŸ§³ ( can hold up to 240 pounds) #travel #viral #amazonfinds #shorts #asmrsounds',
        author: 'The Hayeks',
        hashtags: ['funny', 'humor']
      },
{
        id: 6, //
        videoId: 'dsKiCXKYKDQ',
        title: 'traveling ðŸ«¶ðŸ¼ #travel #girly #airport #vlog #skincare #beauty #foryou #fyp #pov #mood #aesthetic',
        author: 'callie guerra',
        hashtags: ['funny', 'humor', 'art', 'music', 'photography']
      },
{
        id: 7,
        videoId: 'EKO6hOUnbgE',
        title: 'Places On Earth That Don\'t Feel Real #travel #nature #adventure',
        author: 'Fantasy World',
        hashtags: ['funny', 'humor']
      },
{
        id: 11,
        videoId: 'B6WEnRzDcOc',
        title: '10 AMAZING Travel Finds  #shorts #travel #justicebuys',
        author: 'Justice Buys',
        hashtags: ['funny', 'humor']
      },
{
        id: 9,
        videoId: 'UH7v283FZPo',
        title: 'Banana plane is taking off soon! Hurry up! #plane #travel #banana #magic #aiart',
        author: 'Cute Commute',
        hashtags: ['funny', 'humor']
      },
{
        id:  10,
        videoId: 'GEvqFuDL6lE',
        title: 'Best nature whatsapp status||village nature|| video #shorts #nature #viral #trending',
        author: 'Dee Vibe Plus',
        hashtags: ['funny', 'humor', 'art', 'music', 'photography', 'conspiracy', 'health', 'lifestyle', 'dance']
      },

];
// Pre-select first 6 diverse videos for profiling (one per major category)
const initialDiverseVideos = [
  videoData.find(v => v.hashtags.includes('funny')),      // ID 1
  videoData.find(v => v.hashtags.includes('art')),        // ID 11 (art, music, photography)
  videoData.find(v => v.hashtags.includes('conspiracy')), // ID 21
  videoData.find(v => v.hashtags.includes('health')),     // ID 29
  videoData.find(v => v.hashtags.includes('tech')),       // ID 36
  videoData.find(v => v.hashtags.includes('music')) || videoData.find(v => v.hashtags.includes('photography')) // Fallback ID 11/14
].filter(Boolean);

let simulationState = {
  feed: [],
  viewedIds: new Set(),
  maxVideos: 20,  // Increased for longer demo
  playerObjects: {},
  observer: null,
  currentIndex: 0,
  nextVideos: [],
  profileBuilt: false  // Track after initial 6
};

let userProfile = { engagement: {} };
let ytReady = false;
let isLoading = false;

function onYouTubeIframeAPIReady() {
  ytReady = true;
  initializeFeed();
}

function initializeFeed() {
  const feedContainer = document.getElementById('feed-container');
  feedContainer.innerHTML = '';
  // Load FIRST 6 DIVERSE videos for profiling
  initialDiverseVideos.forEach(createPost);
  console.log('=== PROFILING PHASE STARTED ===');
  console.log('Initial diverse videos loaded:', initialDiverseVideos.map(v => ({title: v.title, hashtags: v.hashtags})));
  console.log('Goal: Engage with 6 to build accurate user profile before personalization.');
  computeNextVideos(2);
  setupObserver();
  setupSnapScroll();
}

function createPost(video) {
  const feedContainer = document.getElementById('feed-container');
  const post = document.createElement('div');
  post.className = 'video-post';
  post.id = `post-video-${video.id}`;
  post.dataset.videoId = video.id;

  const playerContainer = document.createElement('div');
  playerContainer.className = 'player-container';
  playerContainer.id = `player-video-${video.id}`;

  const overlay = document.createElement('div');
  overlay.className = 'video-overlay';
  overlay.innerHTML = `
    <div class="video-info">
      <p class="author">${video.author}</p>
      <p class="title">${video.title}</p>
    </div>
    <div class="video-actions">
      <i class="far fa-heart action-icon like-button" data-action="like" data-video-id="${video.id}"></i>
      <i class="far fa-comment action-icon" data-action="comment" data-video-id="${video.id}"></i>
      <i class="far fa-paper-plane action-icon" data-action="share" data-video-id="${video.id}"></i>
    </div>
  `;

  post.appendChild(playerContainer);
  post.appendChild(overlay);
  feedContainer.appendChild(post);

  if (ytReady) {
    const player = new YT.Player(`player-video-${video.id}`, {
      height: '640',
      width: '390',
      videoId: video.videoId,
      playerVars: {
        autoplay: 1,
        mute: 1,
        playsinline: 1,
        controls: 0,           // No controls
        fs: 0,                 // No fullscreen
        rel: 0,                // No related videos
        modestbranding: 2,     // Hide logo completely
        showinfo: 0,
        iv_load_policy: 3,     // No annotations
        loop: 1,               // Loop the video
        playlist: video.videoId  // Loop same video (prevents end screen)
      },
      events: {
        'onReady': (e) => {
          e.target.mute();
          simulationState.playerObjects[video.id] = e.target;
          simulationState.feed.push(video);
          simulationState.viewedIds.add(video.id);
          if (simulationState.feed.length === 1) e.target.playVideo();
          console.log(`Player ready: ${video.title} (looping enabled)`);
        },
        'onStateChange': (e) => {
          if (e.data === YT.PlayerState.ENDED) {
            e.target.playVideo();  // Force restart/loop
            console.log(`Restarted: ${video.title} (no end screen)`);
          }
        }
      }
    });
  }

  overlay.querySelectorAll('.action-icon').forEach(icon => {
    icon.addEventListener('click', handleFeedClick);
  });
  updateFocusClasses();
  simulationState.observer?.observe(post);
  return post;
}

function computeNextVideos(num = 2) {
  simulationState.nextVideos = [];
  for (let i = 0; i < num; i++) {
    const next = getNextVideo();
    if (next) simulationState.nextVideos.push(next);
  }
  console.log('ðŸ”® Precomputed next 2:', simulationState.nextVideos.map(v => `${v.title} (${v.hashtags.join(',')})`));
}

function preloadNextVideos() {
  if (isLoading || simulationState.feed.length >= simulationState.maxVideos) return;
  isLoading = true;
  simulationState.nextVideos.slice(0, 2).forEach(video => {
    if (!simulationState.viewedIds.has(video.id)) createPost(video);
  });
  computeNextVideos(2);
  isLoading = false;
}

function getNextVideo() {
  if (simulationState.feed.length >= simulationState.maxVideos) return null;
  const unseen = videoData.filter(v => !simulationState.viewedIds.has(v.id));
  if (unseen.length === 0) return null;

  const totalEngagement = Object.values(userProfile.engagement).reduce((a, b) => a + b, 0);
  console.log(`ðŸ“Š Current profile:`, userProfile.engagement, `Total score: ${totalEngagement}`);

  if (!simulationState.profileBuilt || totalEngagement < 10) {  // Delay personalization until ~6 views + some engagement
    simulationState.profileBuilt = simulationState.feed.length >= 6;
    console.log(simulationState.profileBuilt ? 'âœ… Profile built - now personalizing!' : 'â³ Still profiling...');
    return unseen[Math.floor(Math.random() * unseen.length)];
  }

  let candidates = [];
  const topTags = Object.entries(userProfile.engagement)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 3)
    .map(([tag]) => tag);

  topTags.forEach(tag => {
    unseen.forEach(video => {
      if (video.hashtags.includes(tag)) {
        candidates.push({ video, score: userProfile.engagement[tag] });
      }
    });
  });

  for (let i = 0; i < Math.floor(unseen.length * 0.3); i++) {
    const randomVideo = unseen[Math.floor(Math.random() * unseen.length)];
    candidates.push({ video: randomVideo, score: 1 });
  }

  const rand = Math.random() * 1.5;
  const pick = candidates[Math.floor(rand * candidates.length)];
  console.log(`ðŸŽ¯ Selected "${pick?.video.title}" (score: ${pick?.score}) | Top tags: [${topTags.join(', ')}]`);
  return pick?.video;
}

// Rest of functions unchanged: setupObserver, setupSnapScroll, updateFocusClasses, handleFeedClick, trackEngagement (enhanced log), handleCommentClick, handleShareClick

function setupObserver() {
  const observerOptions = {
    root: document.getElementById('feed-container'),
    threshold: 0.5
  };
  simulationState.observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const index = simulationState.feed.findIndex(v => `post-video-${v.id}` === entry.target.id);
      if (entry.isIntersecting && index === simulationState.currentIndex) {
        const player = simulationState.playerObjects[simulationState.feed[index].id];
        if (player) {
          player.playVideo();
          console.log(`â–¶ï¸ Playing: ${simulationState.feed[index].title} (${simulationState.feed[index].hashtags.join(', ')})`);
        }
        Object.values(simulationState.playerObjects).forEach((p, idx) => {
          if (idx !== index) p.pauseVideo();
        });
        setTimeout(() => trackEngagement(simulationState.feed[index], 'longView'), 3000);
      }
    });
  }, observerOptions);
}

function setupSnapScroll() {
  const feedContainer = document.getElementById('feed-container');
  let scrollTimeout;
  feedContainer.addEventListener('scroll', () => {
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => {
      const scrollTop = feedContainer.scrollTop;
      const newIndex = Math.round(scrollTop / window.innerHeight);
      simulationState.currentIndex = Math.max(0, Math.min(newIndex, simulationState.feed.length - 1));
      if (simulationState.currentIndex + 3 >= simulationState.feed.length) {
        preloadNextVideos();
      }
      updateFocusClasses();
    }, 100, { passive: true });
  }, { passive: true });
}

function updateFocusClasses() {
  document.querySelectorAll('.video-post').forEach((post, idx) => {
    post.classList.remove('item-focus', 'item-next', 'item-hide');
    if (idx < simulationState.currentIndex) post.classList.add('item-hide');
    else if (idx === simulationState.currentIndex) post.classList.add('item-focus');
    else if (idx === simulationState.currentIndex + 1) post.classList.add('item-next');
  });
}

function handleFeedClick(e) {
  const target = e.target;
  if (!target.classList.contains('action-icon')) return;
  const action = target.dataset.action;
  const videoId = parseInt(target.dataset.videoId);
  const video = videoData.find(v => v.id === videoId);

  switch (action) {
    case 'like':
      target.classList.toggle('liked');
      if (target.classList.contains('liked')) target.classList.replace('far', 'fas');
      else target.classList.replace('fas', 'far');
      trackEngagement(video, 'like');
      preloadNextVideos();
      break;
    case 'comment':
      handleCommentClick(videoId);
      trackEngagement(video, 'comment');
      preloadNextVideos();
      break;
    case 'share':
      handleShareClick(videoId);
      trackEngagement(video, 'share');
      preloadNextVideos();
      break;
  }
}

function trackEngagement(video, type) {
  const weights = { like: 3, comment: 5, share: 4, longView: 2 };
  const weight = (weights[type] || 1);
  const before = { ...userProfile.engagement };
  video.hashtags.forEach(tag => {
    userProfile.engagement[tag] = (userProfile.engagement[tag] || 0) + weight;
  });
  console.log(`ðŸ’¥ ${type.toUpperCase()} on "${video.title}" (+${weight} pts)`);
  console.log('Before:', before);
  console.log('After:', userProfile.engagement);
  console.log('---');
}

function handleCommentClick(videoId) {
  const modalContainer = document.getElementById('modal-container');
  modalContainer.innerHTML = `
    <div class="modal is-active comment-modal">
      <div class="modal-background" onclick="document.getElementById('modal-container').innerHTML=''"></div>
      <div class="modal-content" style="max-width: 400px;">
        <div class="box">
          <div style="padding:20px; background: #262626; color: white; border-radius: 12px;">
            <h3 style="margin-bottom:16px;">Comments</h3>
            <p style="color: #8e8e8e;">No comments yet...</p>
            <input class="input mt-3" type="text" placeholder="Add a comment..." style="background: #1e1e1e; color: white; border: 1px solid #404040;">
          </div>
        </div>
      </div>
    </div>
  `;
}

function handleShareClick(videoId) {
  const video = videoData.find(v => v.id === videoId);
  console.log('ðŸ“± Shared', video.title);
}
</script>
</body>
</html>




